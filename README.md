# Отчет

ФИО: Трефилов Степан Захарович

### Задание A-09

```
Написать программу вычисления матричного выражения:

A = 1 + <B x, y>/<x, y> + <B2 x, y>/<x, y>+ <B3 x, y>/<x, y> + <B4 x, y>/<x, y>

Распараллелить эту программу с помощью OpenMP (parallel, task).
Исследовать зависимость масштабируемости параллельной версии программы от ее
вычислительной трудоемкости (размера матриц).
Проверить корректность параллельной версии.
Проверка закона Амдала. Построить зависимость ускорение:число потоков для заданного
примера.
```

### Тестовый стенд
На тестовом стенде используется Intel Xeon следующей модели
```
Architecture:             x86_64
  CPU op-mode(s):         32-bit, 64-bit
  Address sizes:          39 bits physical, 48 bits virtual
  Byte Order:             Little Endian
CPU(s):                   12
  On-line CPU(s) list:    0-11
Vendor ID:                GenuineIntel
  Model name:             Intel(R) Xeon(R) E-2136 CPU @ 3.30GHz
```

### Описание метода решения задачи
Была написана программа на языке Си для вычисления предложенного выражения.

После написания последовательной версии, была написанная парараллельна версия. Параллельность обеспечивается в самом горячем коде - умножении матриц - за счет разделения задачи умножения матрицы между разными ядрами. Параллельность делается на уровне вычисления строк матрицы-результата, то есть каждую строку считай отдельный поток.

Программный код доступен по [ссылке](https://github.com/IAmFunkyFrog/amdhal_law_exp)

Важное уточнение: прогармма компилируется с опцией -O0. То есть, в замерах никак не учитываются возмодности процессора по векторизации кода (SIMD).

### Результаты измерений

Каждый результат по времени исполнения некоторой конфигурации программы был получен как среднее 10 запусков. При необходимости можно сделать больше запусков, однако стандартное отклонение довольно низкое для десяти запусков, то есть результаты довольно стабильны.

```
Dims - размерность матрицы
Avg - среднее время вычисление формулы в секундах
Dev - дисперсия вычислений
```

Результаты последовательной версии программы:

| Dims | Avg       | Dev      |
|------|-----------|----------|
|  128 |  0.072519 | 0.000001 |
|  192 |  0.242227 | 0.000009 |
|  256 |  0.692970 | 0.000095 |
|  320 |  1.195373 | 0.000326 |
|  384 |  2.311281 | 0.000469 |
|  448 |  3.485065 | 0.001267 |
|  512 |  5.667709 | 0.003528 |
|  576 |  7.735817 | 0.002037 |
|  640 | 10.961903 | 0.009261 |
|  704 | 14.301787 | 0.023237 |
|  768 | 18.827127 | 0.062148 |
|  832 | 24.107943 | 0.098298 |
|  896 | 30.456128 | 0.163616 |
|  960 | 37.590857 | 0.153784 |
| 1024 | 46.470748 | 0.144010 |

Результаты параллельной версии программы:

| Dims | Avg      | Dev      |
|------|----------|----------|
|  128 | 0.013432 | 0.000001 |
|  192 | 0.044022 | 0.000001 |
|  256 | 0.131614 | 0.000001 |
|  320 | 0.212199 | 0.000010 |
|  384 | 0.424760 | 0.000008 |
|  448 | 0.617219 | 0.000016 |
|  512 | 1.071183 | 0.000014 |
|  576 | 1.378745 | 0.000258 |
|  640 | 2.089594 | 0.000402 |
|  704 | 2.666061 | 0.000712 |
|  768 | 3.750764 | 0.000389 |
|  832 | 4.792871 | 0.000404 |
|  896 | 6.238800 | 0.001322 |
|  960 | 7.626134 | 0.001112 |
| 1024 | 9.491117 | 0.004746 |


```
Proc - количество потоков
AmdhalLimit - теоретический максимум ускорение
Calculated - подсчитанное ускорение
```

Проверка закона Амдала (теоретический максимум против подсчитанного значения):

| Proc | AmdhalLimit | Calculated |
|------|-------------|------------|
|    1 |           1 |   0.849999 |
|    2 |           2 |   1.628287 |
|    3 |           3 |   2.418617 |
|    4 |           4 |   3.214954 |
|    5 |           5 |   3.929802 |
|    6 |           6 |   4.558118 |
|    7 |           7 |   3.726131 |
|    8 |           8 |   4.137292 |
|    9 |           9 |   4.428563 |
|   10 |          10 |   4.409429 |
|   11 |          11 |   4.664332 |
|   12 |          12 |   5.011757 |

### Графическое сравнение

##### Среднее время выполнения параллельного решения против обычного
![](./results/par_vs_seq.png)

##### Сравнение полученного ускорения против теоретического максимума по закону Амдала
![](./results/amdhal.png)

### Результаты

1. Как можно видеть по графикам, среднее время выполнения в параллельном режиме существенно ниже, чем в последовательном. Тем не менее, оба графика являются являются параболами, так как умножение матриц - кубический алгоритм.

2. Максимальное ускорение, которое позволил получить процессор с тестового стенда без использования компиляторных оптимизаций, оказалось равно 5. Теоретический максимум при этом равен 12.

##### Вывод

Параллелизация матричного умножения может существенно ускорить вычисление заданной формулы. Тем не менее, сложность алгоритма все еще кубическая, и чтобы показывать хорошее время на больших размерностях будет необходимо использовать более многоядерные машины.